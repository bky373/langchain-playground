import dotenv
from langchain_community.tools import TavilySearchResults
from langchain_core.messages import HumanMessage
from langchain_openai import ChatOpenAI
from langgraph.prebuilt import create_react_agent

dotenv.load_dotenv()
model = ChatOpenAI(model="gpt-4")
tools = [(TavilySearchResults(max_results=2))]

agent_executor = create_react_agent(model, tools)
for chunk in agent_executor.stream(
    {"messages": [HumanMessage(content="what's the weather in SF?")]}
):
    print(chunk)
    print("----")

"""
{'agent': {'messages': [AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_8JwtQm9BSKzr2IerUdVYDVpU', 'function': {'arguments': '{\n  "query": "current weather in San Francisco"\n}', 'name': 'tavily_search_results_json'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 88, 'total_tokens': 111}, 'model_name': 'gpt-4-0613', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-4c000dc4-1295-4bca-8b73-70e0a864de20-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current weather in San Francisco'}, 'id': 'call_8JwtQm9BSKzr2IerUdVYDVpU', 'type': 'tool_call'}], usage_metadata={'input_tokens': 88, 'output_tokens': 23, 'total_tokens': 111})]}}
----
{'tools': {'messages': [ToolMessage(content='[{"url": "https://www.weatherapi.com/", "content": "{\'location\': {\'name\': \'San Francisco\', \'region\': \'California\', \'country\': \'United States of America\', \'lat\': 37.78, \'lon\': -122.42, \'tz_id\': \'America/Los_Angeles\', \'localtime_epoch\': 1725204577, \'localtime\': \'2024-09-01 08:29\'}, \'current\': {\'last_updated_epoch\': 1725203700, \'last_updated\': \'2024-09-01 08:15\', \'temp_c\': 15.3, \'temp_f\': 59.5, \'is_day\': 1, \'condition\': {\'text\': \'Partly cloudy\', \'icon\': \'//cdn.weatherapi.com/weather/64x64/day/116.png\', \'code\': 1003}, \'wind_mph\': 9.4, \'wind_kph\': 15.1, \'wind_degree\': 280, \'wind_dir\': \'W\', \'pressure_mb\': 1016.0, \'pressure_in\': 29.99, \'precip_mm\': 0.0, \'precip_in\': 0.0, \'humidity\': 87, \'cloud\': 50, \'feelslike_c\': 15.3, \'feelslike_f\': 59.5, \'windchill_c\': 14.0, \'windchill_f\': 57.3, \'heatindex_c\': 14.4, \'heatindex_f\': 58.0, \'dewpoint_c\': 12.3, \'dewpoint_f\': 54.1, \'vis_km\': 16.0, \'vis_miles\': 9.0, \'uv\': 4.0, \'gust_mph\': 11.0, \'gust_kph\': 17.6}}"}, {"url": "https://www.weather.gov/mtr/?os=ios&ref=app", "content": "Last Map Update: Sat, Aug 31, 2024 at 4:10:13 pm PDT Watches, Warnings & Advisories ... Text Product Selector (Selected product opens in current window) Social Media. San Francisco Radar. Sacramento Radar. Satellite. Weather Map. Local Graphical Forecast ... National Weather Service San Francisco Bay Area, CA 21 Grace Hopper Ave, Stop 5"}]', name='tavily_search_results_json', tool_call_id='call_8JwtQm9BSKzr2IerUdVYDVpU', artifact={'query': 'current weather in San Francisco', 'follow_up_questions': None, 'answer': None, 'images': [], 'results': [{'title': 'Weather in San Francisco', 'url': 'https://www.weatherapi.com/', 'content': "{'location': {'name': 'San Francisco', 'region': 'California', 'country': 'United States of America', 'lat': 37.78, 'lon': -122.42, 'tz_id': 'America/Los_Angeles', 'localtime_epoch': 1725204577, 'localtime': '2024-09-01 08:29'}, 'current': {'last_updated_epoch': 1725203700, 'last_updated': '2024-09-01 08:15', 'temp_c': 15.3, 'temp_f': 59.5, 'is_day': 1, 'condition': {'text': 'Partly cloudy', 'icon': '//cdn.weatherapi.com/weather/64x64/day/116.png', 'code': 1003}, 'wind_mph': 9.4, 'wind_kph': 15.1, 'wind_degree': 280, 'wind_dir': 'W', 'pressure_mb': 1016.0, 'pressure_in': 29.99, 'precip_mm': 0.0, 'precip_in': 0.0, 'humidity': 87, 'cloud': 50, 'feelslike_c': 15.3, 'feelslike_f': 59.5, 'windchill_c': 14.0, 'windchill_f': 57.3, 'heatindex_c': 14.4, 'heatindex_f': 58.0, 'dewpoint_c': 12.3, 'dewpoint_f': 54.1, 'vis_km': 16.0, 'vis_miles': 9.0, 'uv': 4.0, 'gust_mph': 11.0, 'gust_kph': 17.6}}", 'score': 0.9625151, 'raw_content': None}, {'title': 'San Francisco Bay Area, CA - National Weather Service', 'url': 'https://www.weather.gov/mtr/?os=ios&ref=app', 'content': 'Last Map Update: Sat, Aug 31, 2024 at 4:10:13 pm PDT Watches, Warnings & Advisories ... Text Product Selector (Selected product opens in current window) Social Media. San Francisco Radar. Sacramento Radar. Satellite. Weather Map. Local Graphical Forecast ... National Weather Service San Francisco Bay Area, CA 21 Grace Hopper Ave, Stop 5', 'score': 0.86188734, 'raw_content': None}], 'response_time': 2.71})]}}
----
{'agent': {'messages': [AIMessage(content="The current weather in San Francisco, California, USA is partly cloudy with a temperature of 15.3°C (59.5°F). The wind is blowing from the west at a speed of 15.1 kph (9.4 mph). The humidity is at 87% and there's no precipitation at the moment. The visibility stands at 16.0 km (9.0 miles) [source](https://www.weatherapi.com/).", additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 94, 'prompt_tokens': 634, 'total_tokens': 728}, 'model_name': 'gpt-4-0613', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-df03b176-22fd-4702-ba88-1cb5a9270134-0', usage_metadata={'input_tokens': 634, 'output_tokens': 94, 'total_tokens': 728})]}}
----
"""
